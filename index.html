<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JCI è‡ªåŠ©å ±åˆ°ç³»çµ± V2.6</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { 
            --jci-blue: #0097D7; 
            --jci-dark: #005780;
            --accent: #FFC107; 
            --bg-gradient: linear-gradient(135deg, #0097D7 0%, #005780 100%);
        }
        
        body { 
            font-family: 'Noto Sans TC', sans-serif; margin: 0; background: #f0f2f5; 
            height: 100vh; display: flex; flex-direction: column; overflow-x: hidden;
        }

        /* ç³»çµ±é–å®šé®ç½© */
        #system-lock-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 1); z-index: 9999;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .lock-card {
            background: white; padding: 40px; border-radius: 20px; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15); max-width: 350px; width: 90%;
        }
        .lock-icon { font-size: 4rem; color: var(--jci-dark); margin-bottom: 20px; }

        /* å°èˆªåˆ— */
        #nav-bar { 
            background: rgba(255, 255, 255, 0.98); 
            padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); z-index: 999; position: sticky; top: 0; height: 50px;
        }
        .hide-nav { display: none !important; }
        .event-badge { background: #333; color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 5px; z-index: 1001; }
        .nav-group { display: flex; gap: 5px; }
        .nav-item { cursor: pointer; color: #666; font-weight: 500; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; transition: all 0.3s ease; white-space: nowrap; }
        .nav-item.active { background: var(--jci-blue); color: white; box-shadow: 0 2px 10px rgba(0,151,215,0.3); }
        .mobile-menu-btn { display: none; font-size: 1.8rem; cursor: pointer; color: var(--jci-dark); z-index: 1001; user-select: none; }
        .mobile-dropdown {
            display: none; position: absolute; top: 70px; left: 0; width: 100%;
            background: white; flex-direction: column; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-bottom: 1px solid #eee; animation: slideDown 0.3s ease;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .nav-group { display: none; }
            .mobile-menu-btn { display: block; }
            .mobile-dropdown.show { display: flex; }
            .nav-item { border-radius: 0; padding: 15px; text-align: center; border-bottom: 1px solid #f5f5f5; font-size: 1.1rem; }
            .nav-item:last-child { border-bottom: none; }
            .nav-item.active { background: #e3f2fd; color: var(--jci-blue); box-shadow: none; }
        }

        .page { display: none; flex: 1; overflow-y: auto; padding: 20px; animation: fadeIn 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .login-bg { display: flex; align-items: flex-start; justify-content: center; min-height: 80vh; padding: 20px; box-sizing: border-box; }
        .login-card { background: white; width: 100%; max-width: 400px; padding: 30px; border-radius: 24px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.08); position: relative; overflow: hidden; margin-top: 10px; }
        .login-logo { width: 70%; max-width: 220px; height: auto; margin: 0 auto 15px auto; display: block; }

        #pass-area { display: none; margin-top: 10px; animation: fadeIn 0.5s; }
        #pass-photo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; border: 4px solid #f0f2f5; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        #pass-name { font-weight: bold; font-size: 1.6rem; margin-top: 5px; margin-bottom: 0; color: var(--jci-dark); line-height: 1.2; }
        #pass-title { color: #888; font-size: 1rem; margin-bottom: 5px; }
        #qrcode { margin: 10px auto; display: flex; justify-content: center; align-items: center; padding: 10px; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: fit-content; }
        #qrcode img { display: block; }
        .save-hint { font-size: 0.8rem; color: #999; background: #f8f9fa; padding: 5px 10px; border-radius: 15px; display: inline-block; margin-bottom: 5px; }

        .styled-input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 1rem; margin-bottom: 15px; box-sizing: border-box; text-align: center; }
        .btn-gradient { width: 100%; padding: 14px; background: var(--bg-gradient); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: 0.3s; margin-top: 5px; box-shadow: 0 5px 15px rgba(0,151,215,0.3); }
        .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,151,215,0.4); }

        @media (max-width: 480px) {
            .login-card { padding: 20px; border-radius: 20px; }
            .login-logo { width: 60%; margin-bottom: 10px; }
            #pass-photo { width: 85px; height: 85px; border-width: 3px; }
            #pass-name { font-size: 1.4rem; }
            #qrcode { padding: 5px; margin-top: 5px; }
        }

        /* â˜…â˜…â˜… V2.6 ä¿®æ­£1ï¼šæ´»å‹•åˆ—è¡¨ CSS å„ªåŒ– (é˜²æ­¢æŒ‰éˆ•è·‘ç‰ˆ) â˜…â˜…â˜… */
        .event-card { 
            background: white; padding: 20px; border-radius: 16px; margin-bottom: 15px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 1px solid #eee; 
            gap: 15px; /* æ–‡å­—èˆ‡æŒ‰éˆ•é–“è· */
        }
        .event-card.active { background: #e3f2fd; border-color: var(--jci-blue); }
        .event-info { 
            flex: 1; /* ä½”æ»¿å‰©é¤˜ç©ºé–“ */
            min-width: 0; /* å…è¨±æ–‡å­—æ›è¡Œ */
            text-align: left;
        }
        .event-btn {
            flex-shrink: 0; /* æŒ‰éˆ•ä¸ç¸®å° */
            white-space: nowrap; /* æ–‡å­—ä¸æ›è¡Œ */
            background: var(--jci-blue); color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; cursor: pointer; font-weight: bold;
        }

        .guest-item { background: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .guest-item.arrived { background: #f9f9f9; }
        .guest-photo-small { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #eee; margin-right: 12px; }
        
        #dashboard-grid { display: flex; flex-wrap: wrap; gap: 20px; padding: 10px; justify-content: center; }
        .vip-card { background: white; padding: 25px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 260px; flex-grow: 1; max-width: 320px; border: 4px solid transparent; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .avatar { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 5px solid #f0f2f5; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .vip-card.new-arrival { border-color: #ff3d00; background: #fff9c4; box-shadow: 0 0 40px rgba(255, 61, 0, 0.6); animation: distinctFlash 1.5s infinite alternate; transform: scale(1.05); z-index: 10; }
        @keyframes distinctFlash { 0% { border-color: #ff3d00; } 100% { border-color: #FFC107; } }

        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--jci-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 4px 20px rgba(0,151,215,0.4); cursor: pointer; z-index: 200; }
        #site-qr-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #site-qr-box { background: white; padding: 40px; border-radius: 20px; text-align: center; }

        #kiosk-start-btn { width: 260px; height: 260px; border-radius: 50%; font-size: 2.2rem; background: var(--bg-gradient); color: white; border: none; box-shadow: 0 15px 40px rgba(0,151,215,0.5); cursor: pointer; animation: pulse 2s infinite; font-weight: bold; letter-spacing: 2px; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 15px 40px rgba(0,151,215,0.5); } 50% { transform: scale(1.05); box-shadow: 0 20px 50px rgba(0,151,215,0.7); } 100% { transform: scale(1); box-shadow: 0 15px 40px rgba(0,151,215,0.5); } }
        #kiosk-scanner-container { display: none; width: 100%; max-width: 500px; background: black; border-radius: 25px; overflow: hidden; margin: 0 auto; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        #kiosk-success-view { display: none; text-align: center; }
        .countdown-bar { height: 6px; background: #eee; width: 100%; margin-top: 25px; border-radius: 10px; overflow: hidden; }
        .countdown-fill { height: 100%; background: #28a745; width: 100%; transition: width 3s linear; }

        /* SweetAlert è¡¨å–® (å¼·åˆ¶ä¸€æ¬„å‚ç›´) */
        #swal-form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            width: 100%;
            margin-top: 15px;
        }
        
        .swal-wide-popup { width: 500px !important; max-width: 95% !important; }

        .swal-large-input {
            width: 100%;
            padding: 15px !important;
            font-size: 1.2rem !important;
            border: 2px solid #eee;
            border-radius: 10px;
            box-sizing: border-box;
            background: #f9fcff;
        }
        .swal-large-input:focus { border-color: var(--jci-blue); outline: none; }

        .settings-btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        .settings-action-btn {
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .settings-action-btn:active { transform: scale(0.98); }

        /* â˜…â˜…â˜… V2.6 æ–°å¢ï¼šè¼¸å…¥ç«¯æƒæçµæœé®ç½© (ä»¿ Kiosk) â˜…â˜…â˜… */
        #reception-scan-result {
            display: none; /* é è¨­éš±è— */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 99999;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .result-content { max-width: 400px; width: 90%; }
        /* æˆåŠŸç¶ è‰² */
        .status-success { color: #28a745; }
        /* é‡è¤‡é»ƒè‰² */
        .status-warning { color: #ffc107; }

    </style>
</head>
<body>

    <div id="system-lock-screen">
        <div class="lock-card">
            <div class="lock-icon">ğŸ”’</div>
            <h2 style="margin: 0 0 10px 0;">ç³»çµ±å·²é–å®š</h2>
            <p style="color:#666; margin-bottom:20px;">è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ä»¥é€²å…¥</p>
            <input type="password" id="lock-password" class="styled-input" placeholder="å¯†ç¢¼">
            <button class="btn-gradient" onclick="unlockSystem()">ç™»å…¥ç³»çµ±</button>
        </div>
    </div>

    <div id="reception-scan-result">
        <div class="result-content">
            <div id="scan-icon" style="font-size: 5rem; line-height: 1;">âœ”</div>
            <h2 id="scan-status-text" style="margin:10px 0 0 0; font-size:2rem;">å ±åˆ°æˆåŠŸ</h2>
            
            <img id="scan-photo" class="avatar" style="width:150px; height:150px; margin-top:25px;" src="">
            <h1 id="scan-name" style="color:var(--jci-blue); margin:15px 0 5px 0; font-size:2.5rem;"></h1>
            <div id="scan-title" style="color:#666; font-size:1.5rem;"></div>

            <div class="countdown-bar"><div id="scan-countdown-fill" class="countdown-fill"></div></div>
            <p style="color:#999; margin-top:12px;">3 ç§’å¾Œè‡ªå‹•è¿”å›...</p>
        </div>
    </div>

    <div id="nav-bar">
        <div class="event-badge" onclick="goPage('home')" id="current-event-display">
            <span>ğŸ </span> å°šæœªé¸æ“‡æ´»å‹•
        </div>
        <div class="mobile-menu-btn" onclick="toggleMenu()">â˜°</div>
        <div class="nav-group">
            <div class="nav-item" onclick="goPage('member')">æœƒå“¡é ˜è­‰</div>
            <div class="nav-item" onclick="goPage('kiosk')">è‡ªåŠ©å ±åˆ°</div>
            <div class="nav-item" onclick="goPage('reception')">è¼¸å…¥ç«¯</div>
            <div class="nav-item" onclick="goPage('dashboard')">è¼¸å‡ºç«¯</div>
        </div>
        <div class="mobile-dropdown" id="mobile-nav">
            <div class="nav-item" onclick="goPage('member')">æœƒå“¡é ˜è­‰</div>
            <div class="nav-item" onclick="goPage('kiosk')">è‡ªåŠ©å ±åˆ°</div>
            <div class="nav-item" onclick="goPage('reception')">è¼¸å…¥ç«¯</div>
            <div class="nav-item" onclick="goPage('dashboard')">è¼¸å‡ºç«¯</div>
        </div>
    </div>

    <div id="page-home" class="page active">
        <h2 style="color:#333; text-align: center;">ğŸ“… æ´»å‹•åˆ—è¡¨</h2>
        <div id="event-list" style="max-width: 600px; margin: 0 auto;">è¼‰å…¥ä¸­...</div>
        <div class="fab" onclick="createNewEvent()">+</div>
        <div style="text-align:center; margin-top:40px;">
            <button onclick="showSiteQR()" style="background:white; border:1px solid #ddd; padding:12px 25px; border-radius:30px; cursor:pointer; font-weight:bold; color:#555; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">ğŸ“± é¡¯ç¤ºå…¥å ´ QR</button>
        </div>
    </div>

    <div id="page-member" class="page">
        <div class="login-bg">
            <div class="login-card">
                <img src="https://lh3.googleusercontent.com/d/1XbUrBBqLrGL3wceODZl790Bk1oGTp3do" alt="JCI Dayuan Logo" class="login-logo">
                <div id="login-form" style="margin-top: 20px;">
                    <input type="text" id="login-id" class="styled-input" placeholder="èº«åˆ†è­‰å­—è™Ÿ (è‹±æ–‡å­—æ¯å¤§å¯«)">
                    <input type="text" id="login-dob" class="styled-input" placeholder="ç”Ÿæ—¥ (ä¾‹å¦‚: 19920101)">
                    <button id="btn-verify" class="btn-gradient" onclick="verifyWithGoogle()">é ˜å–é€šè¡Œè­‰</button>
                </div>
                <div id="pass-area">
                    <img id="pass-photo" src="">
                    <div id="pass-name"></div>
                    <div id="pass-title"></div>
                    <div id="qrcode"></div>
                    <div class="save-hint">è«‹æˆªåœ–ä¿å­˜</div>
                    <br>
                    <button onclick="location.reload()" style="background:none; border:none; color:#999; margin-top:10px; cursor:pointer; text-decoration:underline; font-size: 0.9rem;">é‡æ–°é ˜å–</button>
                </div>
            </div>
        </div>
    </div>

    <div id="page-kiosk" class="page">
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:80vh;">
            <div id="kiosk-standby" style="text-align: center;">
                <img src="https://lh3.googleusercontent.com/d/1XbUrBBqLrGL3wceODZl790Bk1oGTp3do" alt="JCI Dayuan Logo" class="login-logo" style="width: 60%; margin-bottom: 40px; opacity: 0.9;">
                <br>
                <button id="kiosk-start-btn" onclick="startKiosk()">é–‹å§‹<br>è‡ªåŠ©å ±åˆ°</button>
                <div style="margin-top:30px; color:#666; font-size:1.3rem; font-weight: bold;">è«‹é»æ“ŠæŒ‰éˆ•é–‹å•Ÿé¡é ­</div>
            </div>

            <div id="kiosk-scanner-container">
                <div style="color:white; padding:20px; text-align:center; font-size: 1.2rem; background: rgba(0,0,0,0.5);">è«‹å‡ºç¤ºæ‚¨çš„ QR Code</div>
                <div id="kiosk-reader" style="width:100%;"></div>
                <button onclick="stopKiosk()" style="width:100%; padding:20px; background:#444; color:white; border:none; cursor:pointer; font-size:1.2rem; font-weight: bold;">è¿”å› / å–æ¶ˆ</button>
            </div>

            <div id="kiosk-success-view" class="login-card" style="width:100%; max-width: 450px;">
                <div style="color:#28a745; font-size:6rem; line-height: 1;">âœ”</div>
                <h2 style="margin:10px 0 0 0; font-size:2.2rem; color: #28a745;">å ±åˆ°æˆåŠŸ</h2>
                <img id="kiosk-photo" class="avatar" style="width:160px; height:160px; margin-top:25px;" src="">
                <h1 id="kiosk-name" style="color:var(--jci-blue); margin:15px 0 5px 0; font-size:2.8rem;"></h1>
                <div id="kiosk-title" style="color:#666; font-size:1.6rem;"></div>
                <div class="countdown-bar"><div id="countdown-fill" class="countdown-fill"></div></div>
                <p style="color:#999; margin-top:12px; font-size: 1rem;">3 ç§’å¾Œè‡ªå‹•è¿”å›...</p>
            </div>
        </div>
    </div>

    <div id="page-reception" class="page">
        <h2 style="margin-bottom:20px; text-align: center;">è¼¸å…¥ç«¯ (æ«ƒå°)</h2>
        <button id="btn-cam" class="btn-gradient" style="background:linear-gradient(45deg, #ff5722, #ff9800); margin-bottom:20px; font-size: 1.2rem;" onclick="toggleCamera()">ğŸ“· æƒæ QR (å¾Œé¡é ­)</button>
        
        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:20px; display:flex; gap:10px; flex-wrap:wrap; border:1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <button onclick="addNewGuest()" style="background:var(--jci-blue); color:white; border:none; padding:12px 20px; border-radius:8px; cursor:pointer; font-weight:bold; flex:1; font-size: 1rem;">â• æ–°å¢ä¾†è³“</button>
            <button onclick="adminSettings()" style="background:#607d8b; color:white; border:none; padding:12px 20px; border-radius:8px; cursor:pointer; font-weight:bold; flex:1; font-size: 1rem;">âš™ï¸ ç³»çµ±è¨­å®š</button>
        </div>

        <div id="scanner-view" style="display:none; background:black; padding:10px; border-radius:20px; margin-bottom:20px; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2);"><div id="reader" style="width:100%"></div></div>
        <div style="position:relative; margin-bottom:15px;"><input type="text" id="search-box" placeholder="ğŸ” æœå°‹å§“å..." class="styled-input" style="margin-bottom: 0; font-size: 1.1rem;" onkeyup="renderReception()"></div>
        <div id="reception-list"></div>
    </div>

    <div id="page-dashboard" class="page" style="background-color: #222; min-height: 100vh;">
        <h2 style="color:white; margin:0 0 30px 0; text-align: center; font-size: 2.5rem; letter-spacing: 2px;">è²´è³“è’è‡¨ç‰†</h2>
        <div id="empty-msg" style="color:#666; text-align:center; margin-top:20%; font-size:1.8rem; display:none; font-weight: bold;">ç­‰å¾…è²´è³“è’è‡¨...</div>
        <div id="dashboard-grid"></div>
    </div>

    <div id="site-qr-modal" onclick="this.style.display='none'">
        <div id="site-qr-box" onclick="event.stopPropagation()">
            <h2 style="margin:0 0 20px 0; color:var(--jci-blue);">æœƒå“¡æƒç¢¼å…¥å ´</h2>
            <div id="site-qrcode" style="margin:30px auto;"></div>
            <p style="color:#666; font-size:1rem;">è«‹æƒææ­¤ç¢¼é ˜å–é›»å­é€šè¡Œè­‰</p>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDLq7SrkQaCnjtsFArh0leKPJRbPFZTZnk",
            authDomain: "checkin2025-f0bb9.firebaseapp.com",
            databaseURL: "https://checkin2025-f0bb9-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "checkin2025-f0bb9",
            storageBucket: "checkin2025-f0bb9.firebasestorage.app",
            messagingSenderId: "526526638146",
            appId: "1:526526638146:web:c69e758e8b3c1d5990e5db",
            measurementId: "G-SDY39SN348"
        };
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyT00r1ap5CkHkuyj3htQ0-AuU65CkidhsxWftaNjWe_9iPgKs6HlaLfqBDPqkV2dUDMQ/exec";

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const defaultAvatar = "https://cdn-icons-png.flaticon.com/512/847/847969.png";
        
        let currentEventId = null;
        let guestsData = {};
        let allEvents = {};
        let html5QrCode = null; 
        let kioskQrCode = null; 
        let isScanning = false;
        let isScanningProcessing = false; // â˜…â˜…â˜… V2.6 æ–°å¢ï¼šé˜²æ­¢é‡è¤‡æƒæçš„é– â˜…â˜…â˜…
        let systemSettings = { locked: false, password: '123' };

        db.ref('settings').on('value', snap => {
            if(snap.val()) {
                systemSettings = snap.val();
                checkSystemLock();
            } else {
                db.ref('settings').set({ locked: true, password: '1234' });
            }
        });

        function checkSystemLock() {
            if (systemSettings.locked && !sessionStorage.getItem('system_unlocked')) {
                document.getElementById('system-lock-screen').style.display = 'flex';
            } else {
                document.getElementById('system-lock-screen').style.display = 'none';
            }
        }

        function unlockSystem() {
            const inputPwd = document.getElementById('lock-password').value;
            if (inputPwd === systemSettings.password) {
                sessionStorage.setItem('system_unlocked', 'true');
                document.getElementById('system-lock-screen').style.display = 'none';
                Swal.fire({ icon: 'success', title: 'ç™»å…¥æˆåŠŸ', timer: 1000, showConfirmButton: false });
            } else {
                Swal.fire('éŒ¯èª¤', 'å¯†ç¢¼ä¸æ­£ç¢º', 'error');
            }
        }

        function adminSettings() {
            Swal.fire({
                title: 'âš™ï¸ ç³»çµ±è¨­å®š',
                html: `
                    <div style="text-align:left; margin-bottom:10px;">ç›®å‰ç‹€æ…‹: ${systemSettings.locked ? '<span style="color:red;font-weight:bold;">å·²é–å®š (å…¬é–‹éœ€å¯†ç¢¼)</span>' : '<span style="color:green;font-weight:bold;">å·²å…¬é–‹ (å…å¯†ç¢¼)</span>'}</div>
                    <button id="toggle-lock-btn" class="btn-gradient" style="background:${systemSettings.locked?'#4caf50':'#f44336'}; margin-bottom:15px; padding:10px;">
                        ${systemSettings.locked ? 'ğŸ”“ è§£é™¤é–å®š (è¨­ç‚ºå…¬é–‹)' : 'ğŸ”’ å•Ÿç”¨é–å®š (è¨­ç‚ºç§å¯†)'}
                    </button>
                    <hr>
                    <h3 style="font-size:1rem; color:#666; margin:15px 0 10px; text-align:left;">ğŸ“¦ è³‡æ–™ç®¡ç†</h3>
                    <div class="settings-btn-grid">
                        <button id="btn-sync" class="settings-action-btn" style="background:#007bff;">â˜ï¸ åŒæ­¥åå–®</button>
                        <button id="btn-export" class="settings-action-btn" style="background:#28a745;">ğŸ“¥ åŒ¯å‡ºç´€éŒ„</button>
                        <button id="btn-clear" class="settings-action-btn" style="background:#ff9800;">âš ï¸ æ¸…ç©ºåå–®</button>
                        <button id="btn-del-evt" class="settings-action-btn" style="background:#d32f2f;">ğŸ—‘ï¸ åˆªé™¤æ´»å‹•</button>
                    </div>
                    <hr>
                    <div style="text-align:left; margin-bottom:5px;">ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼:</div>
                    <input id="new-admin-pwd" class="swal2-input" placeholder="è¼¸å…¥æ–°å¯†ç¢¼" value="${systemSettings.password}">
                `,
                showCancelButton: true,
                confirmButtonText: 'å„²å­˜è®Šæ›´',
                didOpen: () => {
                    document.getElementById('toggle-lock-btn').onclick = () => {
                        const newStatus = !systemSettings.locked;
                        db.ref('settings/locked').set(newStatus);
                        Swal.close();
                        Swal.fire('æˆåŠŸ', newStatus ? 'ç³»çµ±å·²ä¸Šé–' : 'ç³»çµ±å·²å…¬é–‹', 'success');
                    };
                    document.getElementById('btn-sync').onclick = () => { Swal.close(); syncFromCloud(); };
                    document.getElementById('btn-export').onclick = () => { exportCSV(); };
                    document.getElementById('btn-clear').onclick = () => { Swal.close(); clearGuestList(); };
                    document.getElementById('btn-del-evt').onclick = () => { Swal.close(); deleteEvent(); };
                },
                preConfirm: () => { return document.getElementById('new-admin-pwd').value; }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newPwd = result.value;
                    if(newPwd) { db.ref('settings/password').set(newPwd); Swal.fire('æˆåŠŸ', 'å¯†ç¢¼å·²æ›´æ–°', 'success'); }
                }
            });
        }

        db.ref('events_meta').on('value', snap => { allEvents = snap.val() || {}; renderEventList(); });

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'entry') {
                document.getElementById('nav-bar').classList.add('hide-nav');
                goPage('member');
            }
        };

        function toggleMenu() { document.getElementById('mobile-nav').classList.toggle('show'); }

        function goPage(p) {
            if (!currentEventId && p !== 'home' && p !== 'member') return Swal.fire("è«‹å…ˆåœ¨æ´»å‹•å¤§å»³é¸æ“‡ä¸€å€‹æ´»å‹•");
            document.getElementById('mobile-nav').classList.remove('show');
            document.querySelectorAll('.page').forEach(e => e.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            document.querySelectorAll('.nav-group .nav-item').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('#mobile-nav .nav-item').forEach(e => e.classList.remove('active'));

            const navMap = {'member':0, 'kiosk':1, 'reception':2, 'dashboard':3};
            if(navMap[p] !== undefined) {
                const desktopItems = document.querySelectorAll('.nav-group .nav-item');
                if(desktopItems[navMap[p]]) desktopItems[navMap[p]].classList.add('active');
                const mobileItems = document.querySelectorAll('#mobile-nav .nav-item');
                if(mobileItems[navMap[p]]) mobileItems[navMap[p]].classList.add('active');
            }
            if(p !== 'reception') stopCamera(); 
            if(p !== 'kiosk') stopKiosk();
        }

        function createNewEvent() {
            Swal.fire({ title: 'å»ºç«‹æ–°æ´»å‹•', input: 'text', showCancelButton: true }).then((r) => {
                if (r.isConfirmed && r.value) {
                    const id = 'evt_' + Date.now();
                    db.ref('events_meta/' + id).set({ id: id, name: r.value, created: Date.now() });
                    selectEvent(id, r.value);
                }
            });
        }

        // â˜…â˜…â˜… V2.6 ä¿®æ­£ï¼šæ¸²æŸ“æ´»å‹•åˆ—è¡¨ (çµæ§‹å„ªåŒ–ï¼Œé˜²æ­¢æŒ‰éˆ•è·‘ç‰ˆ) â˜…â˜…â˜…
        function renderEventList() {
            const list = document.getElementById('event-list');
            list.innerHTML = '';
            Object.values(allEvents).sort((a,b)=>b.created-a.created).forEach(evt => {
                const div = document.createElement('div');
                div.className = `event-card ${evt.id === currentEventId ? 'active' : ''}`;
                // ä½¿ç”¨æ–°çš„ event-info èˆ‡ event-btn é¡åˆ¥
                div.innerHTML = `
                    <div class="event-info">
                        <div style="font-weight:bold; font-size: 1.1rem; margin-bottom: 5px;">${evt.name}</div>
                        <div style="font-size:0.9rem;color:#888">${new Date(evt.created).toLocaleDateString()}</div>
                    </div>
                    <button class="event-btn" onclick="selectEvent('${evt.id}','${evt.name}')">é€²å…¥æ´»å‹•</button>
                `;
                list.appendChild(div);
            });
        }

        function selectEvent(id, name) {
            currentEventId = id;
            document.getElementById('current-event-display').innerHTML = `<span>ğŸ“…</span> ${name}`;
            db.ref(`events_data/${id}`).off();
            db.ref(`events_data/${id}`).on('value', snap => {
                guestsData = snap.val() || {};
                renderReception();
                renderDashboard();
            });
            goPage('reception');
        }

        function verifyWithGoogle() {
            const id = document.getElementById('login-id').value.trim().toUpperCase();
            const dob = document.getElementById('login-dob').value.trim();
            const btn = document.getElementById('btn-verify');
            if (!id || !dob) return Swal.fire("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");
            
            btn.innerText = "é©—è­‰ä¸­..."; btn.disabled = true;
            fetch(`${GOOGLE_SCRIPT_URL}?id=${id}&dob=${dob}`).then(r => r.json()).then(d => {
                btn.innerText = "é ˜å–é€šè¡Œè­‰"; btn.disabled = false;
                if (d.status === 'success') {
                    document.getElementById('login-form').style.display='none';
                    document.getElementById('pass-area').style.display='block';
                    document.getElementById('pass-name').innerText = d.name;
                    document.getElementById('pass-title').innerText = d.title;
                    document.getElementById('pass-photo').src = d.photo || defaultAvatar;
                    document.getElementById('qrcode').innerHTML = '';
                    let qrSize = 200; if(window.innerWidth < 480) qrSize = 160; 
                    new QRCode(document.getElementById('qrcode'), { text: d.uid, width: qrSize, height: qrSize, colorDark : "#005780", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
                } else { Swal.fire("é©—è­‰å¤±æ•—", "è³‡æ–™ä¸ç¬¦", "error"); }
            }).catch(()=> { btn.innerText="é ˜å–é€šè¡Œè­‰"; btn.disabled=false; Swal.fire("é€£ç·šéŒ¯èª¤", "è«‹æª¢æŸ¥ç¶²è·¯", "error"); });
        }

        function startKiosk() {
            document.getElementById('kiosk-standby').style.display = 'none';
            document.getElementById('kiosk-success-view').style.display = 'none';
            document.getElementById('kiosk-scanner-container').style.display = 'block';
            kioskQrCode = new Html5Qrcode("kiosk-reader");
            kioskQrCode.start({ facingMode: "user" }, { fps: 10, qrbox: { width: 300, height: 300 } }, onKioskScanSuccess)
            .catch(err => { console.error(err); Swal.fire("ç„¡æ³•å•Ÿå‹•å‰é¡é ­", "è«‹ç¢ºèªæ¬Šé™æˆ–ä½¿ç”¨ HTTPS", "error"); stopKiosk(); });
        }
        function stopKiosk() {
            if(kioskQrCode) { kioskQrCode.stop().then(()=>{ kioskQrCode.clear(); kioskQrCode = null; }); }
            document.getElementById('kiosk-scanner-container').style.display = 'none';
            document.getElementById('kiosk-standby').style.display = 'block';
            document.getElementById('kiosk-success-view').style.display = 'none';
        }
        function onKioskScanSuccess(uid) {
            if(kioskQrCode) { kioskQrCode.stop().then(()=>{ kioskQrCode.clear(); kioskQrCode = null; }); }
            document.getElementById('kiosk-scanner-container').style.display = 'none';
            if(guestsData[uid]) {
                const g = guestsData[uid];
                if(!g.arrived) checkIn(uid, true);
                document.getElementById('kiosk-success-view').style.display = 'block';
                document.getElementById('kiosk-photo').src = g.photo || defaultAvatar;
                document.getElementById('kiosk-name').innerText = g.name;
                document.getElementById('kiosk-title').innerText = g.title;
                const fill = document.getElementById('countdown-fill');
                fill.style.transition = 'none'; fill.style.width = '100%';
                setTimeout(() => { fill.style.transition = 'width 3s linear'; fill.style.width = '0%'; }, 100);
                setTimeout(() => { stopKiosk(); }, 3000);
            } else { Swal.fire({ icon: 'error', title: 'æƒæå¤±æ•—', text: 'æ­¤ QR Code ä¸åœ¨åå–®ä¸­', timer: 2000, showConfirmButton: false }).then(() => startKiosk()); }
        }

        function toggleCamera() { isScanning ? stopCamera() : startCamera(); }
        
        // â˜…â˜…â˜… V2.6 ä¿®æ­£2ï¼šè¼¸å…¥ç«¯æƒæé‚è¼¯å„ªåŒ– (é˜²é‡è¤‡ã€å€’æ•¸é®ç½©) â˜…â˜…â˜…
        function startCamera() {
            document.getElementById('scanner-view').style.display = 'block';
            document.getElementById('btn-cam').innerText = "âŒ é—œé–‰ç›¸æ©Ÿ";
            document.getElementById('btn-cam').style.background = "#333";
            
            isScanningProcessing = false; // é‡ç½®é–å®šç‹€æ…‹

            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, (uid)=>{
                // å¦‚æœæ­£åœ¨è™•ç†ä¸­ï¼Œç›´æ¥ç•¥éï¼Œä¸åŸ·è¡Œä»»ä½•å‹•ä½œ (é˜²æ­¢é€£é»)
                if(isScanningProcessing) return; 

                // æ¨™è¨˜ç‚ºè™•ç†ä¸­
                isScanningProcessing = true;

                if(guestsData[uid]) {
                    const g = guestsData[uid];
                    const isDuplicate = g.arrived;

                    // å¦‚æœå°šæœªå ±åˆ°ï¼ŒåŸ·è¡Œå ±åˆ°
                    if(!isDuplicate) {
                        checkIn(uid, true);
                    }

                    // å‘¼å«é¡¯ç¤ºçµæœé®ç½© (æˆåŠŸæˆ–é‡è¤‡)
                    showReceptionResult(g, isDuplicate);

                    // 3ç§’å¾Œè‡ªå‹•é—œé–‰é®ç½©ä¸¦è§£é–ï¼Œå…è¨±ä¸‹ä¸€æ¬¡æƒæ
                    setTimeout(() => {
                        closeReceptionResult();
                        isScanningProcessing = false;
                    }, 3000);

                } else {
                    // æƒåˆ°ç„¡æ•ˆ QRï¼Œé¡¯ç¤ºçŸ­æš«éŒ¯èª¤æç¤ºï¼Œç„¶å¾Œè§£é–
                    Swal.fire({ icon: 'error', title: 'éŒ¯èª¤', text: 'éæœ¬å ´åå–®', timer: 1500, showConfirmButton: false })
                    .then(() => {
                        isScanningProcessing = false;
                    });
                }
            });
            isScanning = true;
        }

        function showReceptionResult(g, isDuplicate) {
            const overlay = document.getElementById('reception-scan-result');
            const icon = document.getElementById('scan-icon');
            const title = document.getElementById('scan-status-text');
            const fill = document.getElementById('scan-countdown-fill');

            // è¨­å®šå…§å®¹
            document.getElementById('scan-photo').src = g.photo || defaultAvatar;
            document.getElementById('scan-name').innerText = g.name;
            document.getElementById('scan-title').innerText = g.title;

            // ä¾ç‹€æ…‹æ”¹è®Šæ¨£å¼
            if(isDuplicate) {
                icon.innerText = "!";
                icon.className = "status-warning";
                title.innerText = "å·²é‡è¤‡å ±åˆ°";
                title.className = "status-warning";
            } else {
                icon.innerText = "âœ”";
                icon.className = "status-success";
                title.innerText = "å ±åˆ°æˆåŠŸ";
                title.className = "status-success";
            }

            // é¡¯ç¤ºé®ç½©
            overlay.style.display = 'flex';

            // åŸ·è¡Œå€’æ•¸å‹•ç•«
            fill.style.transition = 'none'; 
            fill.style.width = '100%';
            setTimeout(() => { 
                fill.style.transition = 'width 3s linear'; 
                fill.style.width = '0%'; 
            }, 50);
        }

        function closeReceptionResult() {
            document.getElementById('reception-scan-result').style.display = 'none';
        }

        function stopCamera() {
            if(html5QrCode) { html5QrCode.stop().then(()=>{ html5QrCode.clear(); html5QrCode = null; }); }
            document.getElementById('scanner-view').style.display = 'none';
            document.getElementById('btn-cam').innerText = "ğŸ“· æƒæ QR (å¾Œé¡é ­)";
            document.getElementById('btn-cam').style.background = "linear-gradient(45deg, #ff5722, #ff9800)";
            document.getElementById('reception-scan-result').style.display = 'none'; // ç¢ºä¿é®ç½©é—œé–‰
            isScanning = false;
        }

        function renderReception() {
            const list = document.getElementById('reception-list');
            const search = document.getElementById('search-box').value.toUpperCase();
            list.innerHTML = '';
            
            Object.values(guestsData)
                .sort((a, b) => (a.originalIndex || 0) - (b.originalIndex || 0))
                .forEach(g => {
                    if(search && g.name.indexOf(search) === -1) return;
                    const d = document.createElement('div');
                    d.className = `guest-item ${g.arrived ? 'arrived' : ''}`;
                    d.innerHTML = `<div style="display:flex; align-items:center;"><img src="${g.photo || defaultAvatar}" class="guest-photo-small"><div><div style="font-weight:bold; font-size:1.1rem;">${g.name}</div><div style="font-size:0.8rem;color:#666">${g.title} | ${g.group}</div></div></div>
                    <div style="display:flex; gap:5px;">
                        <button onclick="checkIn('${g.id}',${!g.arrived})" style="padding:6px 15px;border:none;border-radius:20px;cursor:pointer;background:${g.arrived?'#ccc':'var(--jci-blue)'};color:white;font-weight:bold;">${g.arrived?'å–æ¶ˆ':'ç°½åˆ°'}</button>
                        <button onclick="deleteGuest('${g.id}')" style="padding:6px 10px;border:none;border-radius:50%;background:#ffebee;color:#c62828;cursor:pointer;display:flex;align-items:center;justify-content:center;">ğŸ—‘ï¸</button>
                    </div>`;
                    list.appendChild(d);
                });
        }

        function deleteGuest(uid) {
            Swal.fire({
                title: 'ç¢ºå®šåˆªé™¤?',
                text: "åˆªé™¤å¾Œç„¡æ³•å¾©åŸ",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'åˆªé™¤',
                cancelButtonText: 'å–æ¶ˆ'
            }).then((result) => {
                if (result.isConfirmed) {
                    db.ref(`events_data/${currentEventId}/${uid}`).remove();
                    Swal.fire('å·²åˆªé™¤', '', 'success');
                }
            })
        }

        function checkIn(id, status) {
            db.ref(`events_data/${currentEventId}/${id}`).update({ arrived: status, timestamp: status ? firebase.database.ServerValue.TIMESTAMP : 0, acked: status ? false : null });
        }

        function renderDashboard() {
            const grid = document.getElementById('dashboard-grid');
            const emptyMsg = document.getElementById('empty-msg');
            grid.innerHTML = '';
            let list = Object.values(guestsData).filter(g => {
                if (!g.arrived) return false;
                if (g.group === 'External' || g.group === 'Official' || g.group === 'Officials') return true;
                if ((g.group === 'Internal' || g.group === 'internal') && g.title) {
                      if (g.title.indexOf('æœƒé•·') > -1 || g.title.indexOf('ä¸»å¸­') > -1) return true;
                }
                return false;
            });
            if (list.length === 0) { emptyMsg.style.display = 'block'; return; } else { emptyMsg.style.display = 'none'; }
            list.sort((a, b) => {
                const scoreA = (!a.acked) ? 2 : 1; const scoreB = (!b.acked) ? 2 : 1;
                if (scoreA !== scoreB) return scoreB - scoreA; return (b.timestamp || 0) - (a.timestamp || 0);
            });
            list.forEach(g => {
                const d = document.createElement('div');
                let cardClass = 'vip-card'; if (!g.acked) cardClass += ' new-arrival';
                d.className = cardClass; d.onclick = function() { ackGuest(g.id); }; d.style.cursor = "pointer";
                d.innerHTML = `<img src="${g.photo||defaultAvatar}" class="avatar"><div style="font-weight:bold;margin-bottom:5px; font-size:2.5rem; line-height:1.2;">${g.name}</div><div style="font-size:1.5rem;color:#666;">${g.title}</div>`;
                grid.appendChild(d);
            });
        }
        function ackGuest(id) { db.ref(`events_data/${currentEventId}/${id}`).update({ acked: true }); }
        
        function addNewGuest() {
            Swal.fire({
                title: 'æ–°å¢ç¾å ´ä¾†è³“',
                html: `
                    <div id="swal-form-grid">
                        <input id="swal-name" class="swal-large-input" placeholder="å§“å">
                        <input id="swal-title" class="swal-large-input" placeholder="è·ç¨±">
                        <select id="swal-group" class="swal-large-input">
                            <option value="External">å‹æœƒè²´è³“</option>
                            <option value="Official">é•·å®˜</option>
                            <option value="Internal">æœ¬æœƒæœƒå“¡</option>
                        </select>
                    </div>
                `,
                customClass: { popup: 'swal-wide-popup' },
                showCancelButton: true,
                confirmButtonText: 'æ–°å¢',
                preConfirm: () => {
                    const name = document.getElementById('swal-name').value;
                    if (!name) Swal.showValidationMessage('è«‹è¼¸å…¥å§“å');
                    return {
                        name: name,
                        title: document.getElementById('swal-title').value,
                        group: document.getElementById('swal-group').value
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newId = "walkin_" + Date.now();
                    db.ref(`events_data/${currentEventId}/${newId}`).set({ id: newId, name: result.value.name, title: result.value.title || 'è²´è³“', group: result.value.group, photo: "", arrived: true, timestamp: firebase.database.ServerValue.TIMESTAMP, acked: false, originalIndex: 999999 });
                }
            });
        }

        function clearGuestList() {
            if(!confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰åå–®ï¼Ÿæ´»å‹•å°‡ä¿ç•™ï¼Œä½†ç°½åˆ°è³‡æ–™æœƒæ¶ˆå¤±ã€‚")) return;
            db.ref(`events_data/${currentEventId}`).remove()
              .then(() => Swal.fire("å·²æ¸…ç©º", "åå–®å·²é‡ç½®", "success"));
        }

        function syncFromCloud() {
            Swal.fire({
                title: 'è«‹é¸æ“‡åŒæ­¥ä¾†æº',
                text: "é€™å°‡æœƒè¦†è“‹ç›®å‰çš„åˆå§‹åå–®",
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'åƒ…æœƒå…§æœƒå“¡ (Internal)',
                confirmButtonColor: '#0097D7', 
                showDenyButton: true,
                denyButtonText: 'å…¨é«”åå–® (All Data)',
                denyButtonColor: '#28a745', 
                cancelButtonText: 'å–æ¶ˆ'
            }).then((result) => {
                if (result.isDismissed) return; 
                const onlyInternal = result.isConfirmed; 
                Swal.fire({ title: 'åŒæ­¥ä¸­...', didOpen: () => Swal.showLoading() });
                fetch(`${GOOGLE_SCRIPT_URL}?op=get_all`).then(r => r.json()).then(data => {
                    const newData = {};
                    let count = 0;
                    data.forEach((row, index) => {
                        if (onlyInternal && row.group.toLowerCase() !== 'internal') return;
                        newData[row.id] = { 
                            id: row.id, name: row.name, title: row.title, group: row.group, photo: row.photo, 
                            arrived: false, timestamp: 0, originalIndex: index 
                        };
                        count++;
                    });
                    db.ref(`events_data/${currentEventId}`).set(newData).then(() => Swal.fire("åŒæ­¥æˆåŠŸ", `åŒ¯å…¥ ${count} ç­†`, "success"));
                });
            });
        }

        function exportCSV() {
            let eventName = "ç°½åˆ°è¡¨"; if (currentEventId && allEvents[currentEventId]) eventName = allEvents[currentEventId].name;
            const clean = (text) => String(text || "").replace(/,/g, ' ').replace(/\n/g, ' ').trim();
            let csv = "\uFEFFå§“å,è·ç¨±,åˆ†é¡,ç°½åˆ°ç‹€æ…‹,å ±åˆ°æ™‚é–“\n";
            Object.values(guestsData)
                .sort((a, b) => (a.originalIndex || 0) - (b.originalIndex || 0))
                .forEach(g => {
                    let statusStr = "", timeStr = "";
                    if (g.arrived) { statusStr = "å·²åˆ°"; if (g.timestamp) { let d = new Date(g.timestamp); const pad = (n) => (n < 10 ? '0' + n : n); timeStr = `${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`; } }
                    csv += `${clean(g.name)},${clean(g.title)},${clean(g.group)},${statusStr},${timeStr}\n`;
                });
            const l = document.createElement("a"); l.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'})); l.download = eventName + ".csv"; l.click();
        }
        function deleteEvent() {
            if(!currentEventId || !confirm("ç¢ºå®šåˆªé™¤æ­¤æ´»å‹•ï¼Ÿ")) return;
            db.ref(`events_meta/${currentEventId}`).remove(); db.ref(`events_data/${currentEventId}`).remove();
            currentEventId = null; document.getElementById('current-event-display').innerHTML = "<span>ğŸ </span> å°šæœªé¸æ“‡æ´»å‹•"; goPage('home');
        }
        function showSiteQR() {
            document.getElementById('site-qr-modal').style.display = 'flex'; document.getElementById('site-qrcode').innerHTML = '';
            new QRCode(document.getElementById('site-qrcode'), { text: window.location.href.split('?')[0] + "?mode=entry", width: 250, height: 250 });
        }
    </script>
</body>
</html>